{"version":3,"file":"index.js","sources":["../src/enum.js","../src/route.js","../src/url.ts","../src/index.ts","../src/useForm.js"],"sourcesContent":["export const METHOD = {\n    GET: \"get\",\n    POST: \"post\",\n    PUT: \"put\",\n    PATCH: \"patch\",\n    DELETE: \"delete\",\n}\n","import axios from \"axios\"\nimport { METHOD } from \"./enum\"\nimport { hrefToUrl } from \"./url\"\n\nexport class Route {\n    visit(href, params) {\n        const options = {\n            method: METHOD.GET,\n            data: {},\n            onSuccess: () => {},\n            onError: () => {},\n            onFinish: () => {},\n            ...params,\n        }\n\n        let url = typeof href === \"string\" ? hrefToUrl(href) : href\n\n        const {\n            onSuccess,\n            onError,\n            onFinish,\n        } = options\n\n        axios({\n            method: options.method,\n            url: url.href,\n            data: options.data,\n        }).then(response => {\n            return onSuccess(response)\n        }).catch(error => {\n            const errors = {}\n            if (error.response.status === 422) {\n                const responseErrors = error.response.data.errors\n                Object.keys(responseErrors).forEach((name) => {\n                    errors[name] = responseErrors[name][0]\n                })\n            }\n            return onError(errors)\n        }).then(() => {\n            return onFinish()\n        })\n    }\n\n    get(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: Method.GET,\n            data,\n        })\n    }\n\n    post(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: Method.POST,\n            data,\n        })\n    }\n\n    put(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: Method.PUT,\n            data,\n        })\n    }\n\n    delete(url, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: Method.DELETE,\n        })\n    }\n}\n","export function hrefToUrl(href: string | URL): URL {\n    return new URL(href.toString(), window.location.toString())\n}\n","import { Route } from \"./route\"\nexport { default as useForm } from \"./useForm\"\nexport const Http = new Route()\n","import cloneDeep from \"lodash.clonedeep\"\nimport isEqual from \"lodash.isequal\"\nimport { reactive, watch } from \"vue\"\nimport { Route } from \"./route\"\n\nexport default function useForm(...args) {\n    const data = (typeof args[0] === \"string\" ? args[1] : args[0]) || {}\n    const defaults = cloneDeep(data)\n    let transform = data => data\n    const Http = new Route()\n\n    const form = reactive({\n        ...data,\n        errors: {},\n        isDirty: false,\n        processing: false,\n\n        transform(callback) {\n            transform = callback\n\n            return this\n        },\n\n        data() {\n            return Object\n                .keys(data)\n                .reduce((carry, key) => {\n                    carry[key] = this[key]\n                    return carry\n                }, {})\n        },\n\n        defaults(key, value) {\n            if (typeof key === 'undefined') {\n                defaults = this.data()\n            } else {\n                defaults = Object.assign(\n                    {},\n                    cloneDeep(defaults),\n                    value ? ({ [key]: value }) : key,\n                )\n            }\n\n            return this\n        },\n\n        setError(key, value) {\n            Object.assign(this.errors, (value ? { [key]: value } : key))\n\n            this.hasErrors = Object.keys(this.errors).length > 0\n\n            return this\n        },\n\n        reset(...fields) {\n            const clonedDefaults = cloneDeep(defaults)\n            if (fields.length === 0) {\n                Object.assign(this, clonedDefaults)\n            } else {\n                Object.assign(\n                    this,\n                    Object\n                        .keys(clonedDefaults)\n                        .filter(key => fields.includes(key))\n                        .reduce((carry, key) => {\n                            carry[key] = clonedDefaults[key]\n                            return carry\n                        }, {}),\n                )\n            }\n\n            return this\n        },\n        clearErrors(...fields) {\n            this.errors = Object\n                .keys(this.errors)\n                .reduce((carry, field) => ({\n                    ...carry,\n                    ...(fields.length > 0 && !fields.includes(field) ? { [field]: this.errors[field] } : {}),\n                }), {})\n\n            this.hasErrors = Object.keys(this.errors).length > 0\n\n            return this\n        },\n\n        submit(method, url, options = {}) {\n            this.processing = true\n            const data = transform(this.data())\n\n            const _options = {\n                ...options,\n                onSuccess: async response => {\n                    this.processing = false\n                    const onSuccess = options.onSuccess ? await options.onSuccess(response) : null\n                    this.isDirty = false\n                    return onSuccess\n                },\n                onError: errors => {\n                    this.processing = false\n                    this.clearErrors().setError(errors)\n                    if (options.onError) {\n                        return options.onError(errors)\n                    }\n                },\n                onFinish: () => {\n                    this.processing = false\n                    if (options.onFinish) {\n                        return options.onFinish()\n                    }\n                },\n            }\n            if (method === \"delete\") {\n                Inertia.delete(url, { ..._options, data })\n            } else {\n                Http[method](url, data, _options)\n            }\n        },\n        get(url, options) {\n            this.submit(\"post\", url, options)\n        },\n\n        post(url, options) {\n            this.submit(\"post\", url, options)\n        },\n\n        put(url, options) {\n            this.submit(\"put\", url, options)\n        },\n\n        delete(url, options) {\n            this.submit(\"delete\", url, options)\n        },\n    })\n\n    watch(form, newValue => {\n        form.isDirty = !isEqual(form.data(), defaults)\n    }, {\n        immediate: true,\n        deep: true,\n    })\n\n    return form\n}\n"],"names":["Route","visit","href","params","options","method","data","onSuccess","onError","onFinish","url","URL","toString","window","location","hrefToUrl","axios","then","response","error","errors","status","responseErrors","Object","keys","forEach","name","get","_extends","Method","GET","post","this","POST","_proto","put","PUT","DELETE","Http","args","slice","call","arguments","defaults","cloneDeep","transform","form","reactive","isDirty","processing","callback","reduce","carry","key","_this","value","_readOnlyError","assign","_ref","setError","_ref2","hasErrors","length","reset","fields","clonedDefaults","filter","includes","clearErrors","_this2","field","_ref3","submit","_this4","_this3","_options","_temp2","e","Promise","reject","Inertia","watch","newValue","isEqual","immediate","deep"],"mappings":"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"}