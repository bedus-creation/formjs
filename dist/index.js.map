{"version":3,"file":"index.js","sources":["../src/enum.js","../src/route.js","../src/url.ts","../src/index.ts","../src/useForm.js"],"sourcesContent":["export const METHOD = {\n    GET: \"get\",\n    POST: \"post\",\n    PUT: \"put\",\n    PATCH: \"patch\",\n    DELETE: \"delete\",\n}\n","import axios from \"axios\"\nimport { METHOD } from \"./enum\"\nimport { hrefToUrl } from \"./url\"\n\nexport class Route {\n    visit(href, params) {\n        const options = {\n            method: METHOD.GET,\n            data: {},\n            onSuccess: () => {},\n            onError: () => {},\n            onFinish: () => {},\n            ...params,\n        }\n\n        let url = typeof href === \"string\" ? hrefToUrl(href) : href\n\n        const {\n            onSuccess,\n            onError,\n            onFinish,\n        } = options\n\n        axios({\n            method: options.method,\n            url: url.href,\n            data: options.data,\n        }).then(response => {\n            return onSuccess(response)\n        }).catch(error => {\n            const errors = {}\n            if (error.response.status === 422) {\n                const responseErrors = error.response.data.errors\n                Object.keys(responseErrors).forEach((name) => {\n                    errors[name] = responseErrors[name][0]\n                })\n            }\n            return onError(errors)\n        }).then(() => {\n            return onFinish()\n        })\n    }\n\n    get(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.GET,\n            data,\n        })\n    }\n\n    post(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.POST,\n            data,\n        })\n    }\n\n    put(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.PUT,\n            data,\n        })\n    }\n\n    delete(url, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.DELETE,\n        })\n    }\n}\n","export function hrefToUrl(href: string | URL): URL {\n    return new URL(href.toString(), window.location.toString())\n}\n","import { Route } from \"./route\"\nexport { default as useForm } from \"./useForm\"\nexport const Http = new Route()\n","import cloneDeep from \"lodash.clonedeep\"\nimport isEqual from \"lodash.isequal\"\nimport { reactive, watch } from \"vue\"\nimport { Route } from \"./route\"\n\nexport default function useForm(...args) {\n    const data = (typeof args[0] === \"string\" ? args[1] : args[0]) || {}\n    const defaults = cloneDeep(data)\n    let transform = data => data\n    const Http = new Route()\n\n    const form = reactive({\n        ...data,\n        errors: {},\n        isDirty: false,\n        processing: false,\n\n        transform(callback) {\n            transform = callback\n\n            return this\n        },\n\n        data() {\n            return Object\n                .keys(data)\n                .reduce((carry, key) => {\n                    carry[key] = this[key]\n                    return carry\n                }, {})\n        },\n\n        defaults(key, value) {\n            if (typeof key === 'undefined') {\n                defaults = this.data()\n            } else {\n                defaults = Object.assign(\n                    {},\n                    cloneDeep(defaults),\n                    value ? ({ [key]: value }) : key,\n                )\n            }\n\n            return this\n        },\n\n        setError(key, value) {\n            Object.assign(this.errors, (value ? { [key]: value } : key))\n\n            this.hasErrors = Object.keys(this.errors).length > 0\n\n            return this\n        },\n\n        reset(...fields) {\n            const clonedDefaults = cloneDeep(defaults)\n            if (fields.length === 0) {\n                Object.assign(this, clonedDefaults)\n            } else {\n                Object.assign(\n                    this,\n                    Object\n                        .keys(clonedDefaults)\n                        .filter(key => fields.includes(key))\n                        .reduce((carry, key) => {\n                            carry[key] = clonedDefaults[key]\n                            return carry\n                        }, {}),\n                )\n            }\n\n            return this\n        },\n        clearErrors(...fields) {\n            this.errors = Object\n                .keys(this.errors)\n                .reduce((carry, field) => ({\n                    ...carry,\n                    ...(fields.length > 0 && !fields.includes(field) ? { [field]: this.errors[field] } : {}),\n                }), {})\n\n            this.hasErrors = Object.keys(this.errors).length > 0\n\n            return this\n        },\n\n        submit(method, url, options = {}) {\n            this.processing = true\n            const data = transform(this.data())\n\n            const _options = {\n                ...options,\n                onSuccess: async response => {\n                    this.processing = false\n                    const onSuccess = options.onSuccess ? await options.onSuccess(response) : null\n                    this.isDirty = false\n                    return onSuccess\n                },\n                onError: errors => {\n                    this.processing = false\n                    this.clearErrors().setError(errors)\n                    if (options.onError) {\n                        return options.onError(errors)\n                    }\n                },\n                onFinish: () => {\n                    this.processing = false\n                    if (options.onFinish) {\n                        return options.onFinish()\n                    }\n                },\n            }\n            if (method === \"delete\") {\n                Inertia.delete(url, { ..._options, data })\n            } else {\n                Http[method](url, data, _options)\n            }\n        },\n        get(url, options) {\n            this.submit(\"post\", url, options)\n        },\n\n        post(url, options) {\n            this.submit(\"post\", url, options)\n        },\n\n        put(url, options) {\n            this.submit(\"put\", url, options)\n        },\n\n        delete(url, options) {\n            this.submit(\"delete\", url, options)\n        },\n    })\n\n    watch(form, newValue => {\n        form.isDirty = !isEqual(form.data(), defaults)\n    }, {\n        immediate: true,\n        deep: true,\n    })\n\n    return form\n}\n"],"names":["Route","visit","href","params","options","method","data","onSuccess","onError","onFinish","url","URL","toString","window","location","hrefToUrl","axios","then","response","error","errors","status","responseErrors","Object","keys","forEach","name","get","_extends","post","this","_proto","put","Http","args","slice","call","arguments","defaults","cloneDeep","transform","form","reactive","isDirty","processing","callback","reduce","carry","key","_this","value","_readOnlyError","assign","_ref","setError","_ref2","hasErrors","length","reset","fields","clonedDefaults","filter","includes","clearErrors","_this2","field","_ref3","submit","_this4","_this3","_options","_temp2","e","Promise","reject","Inertia","watch","newValue","isEqual","immediate","deep"],"mappings":"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"}