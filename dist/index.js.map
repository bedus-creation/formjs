{"version":3,"file":"index.js","sources":["../src/route.js","../src/enum.js","../src/url.ts","../src/files.ts","../src/formData.ts","../src/index.ts","../src/useForm.js"],"sourcesContent":["import axios from \"axios\"\nimport { METHOD } from \"./enum\"\nimport { hrefToUrl } from \"./url\"\n\nexport class Route {\n    visit(href, params) {\n        const options = {\n            method: METHOD.GET,\n            data: {},\n            onSuccess: () => {},\n            onError: () => {},\n            onFinish: () => {},\n            ...params,\n        }\n\n        let url = typeof href === \"string\" ? hrefToUrl(href) : href\n\n        const {\n            onSuccess,\n            onError,\n            onFinish,\n        } = options\n\n        axios({\n            method: options.method,\n            url: url.href,\n            data: options.data,\n        }).then(response => {\n            return onSuccess(response)\n        }).catch(error => {\n            const errors = {}\n            if (error.response?.status === 422) {\n                const responseErrors = error.response.data.errors\n                Object.keys(responseErrors).forEach((name) => {\n                    errors[name] = responseErrors[name][0]\n                })\n            }\n            return onError(errors)\n        }).then(() => {\n            return onFinish()\n        })\n    }\n\n    get(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.GET,\n            data,\n        })\n    }\n\n    post(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.POST,\n            data,\n        })\n    }\n\n    put(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.PUT,\n            data,\n        })\n    }\n\n    delete(url, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.DELETE,\n        })\n    }\n}\n","export const METHOD = {\n    GET: \"get\",\n    POST: \"post\",\n    PUT: \"put\",\n    PATCH: \"patch\",\n    DELETE: \"delete\",\n}\n","export function hrefToUrl(href: string | URL): URL {\n    return new URL(href.toString(), window.location.toString())\n}\n","import { FormDataConvertible, RequestPayload } from './types'\n\nexport function hasFiles(data: RequestPayload | FormDataConvertible): boolean {\n    return (\n        data instanceof File ||\n        data instanceof Blob ||\n        (data instanceof FileList && data.length > 0) ||\n        (data instanceof FormData && Array.from(data.values()).some((value) => hasFiles(value))) ||\n        (typeof data === 'object' && data !== null && Object.values(data).some((value) => hasFiles(value)))\n    )\n}\n","import { FormDataConvertible } from \"./types\"\n\nexport function objectToFormData(\n    source: Record<string, FormDataConvertible>,\n    form: FormData = new FormData(),\n    parentKey: string | null = null,\n): FormData {\n    source = source || {}\n\n    for (const key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n            append(form, composeKey(parentKey, key), source[key])\n        }\n    }\n\n    return form\n}\n\nfunction composeKey(parent: string | null, key: string): string {\n    return parent ? parent + \"[\" + key + \"]\" : key\n}\n\nfunction append(form: FormData, key: string, value: FormDataConvertible): void {\n    if (Array.isArray(value)) {\n        return Array.from(value.keys()).forEach((index) => append(form, composeKey(key, index.toString()), value[index]))\n    } else if (value instanceof Date) {\n        return form.append(key, value.toISOString())\n    } else if (value instanceof File) {\n        return form.append(key, value, value.name)\n    } else if (value instanceof Blob) {\n        return form.append(key, value)\n    } else if (typeof value === \"boolean\") {\n        return form.append(key, value ? \"1\" : \"0\")\n    } else if (typeof value === \"string\") {\n        return form.append(key, value)\n    } else if (typeof value === \"number\") {\n        return form.append(key, `${value}`)\n    } else if (value === null || value === undefined) {\n        return form.append(key, \"\")\n    }\n\n    objectToFormData(value, form, key)\n}\n","import { Route } from \"./route\"\nexport { default as useForm } from \"./useForm\"\nexport const Http = new Route()\n","import cloneDeep from \"lodash.clonedeep\"\nimport isEqual from \"lodash.isequal\"\nimport { reactive, watch } from \"vue\"\nimport { Route } from \"./route\"\nimport { hasFiles } from './files'\nimport { objectToFormData } from './formData'\n\nexport default function useForm(...args) {\n    const data = (typeof args[0] === \"string\" ? args[1] : args[0]) || {}\n    const defaults = cloneDeep(data)\n    let transform = data => data\n    const Http = new Route()\n\n    const form = reactive({\n        ...data,\n        errors: {},\n        isDirty: false,\n        processing: false,\n\n        transform(callback) {\n            transform = callback\n\n            return this\n        },\n\n        data() {\n            return Object\n                .keys(data)\n                .reduce((carry, key) => {\n                    carry[key] = this[key]\n                    return carry\n                }, {})\n        },\n\n        defaults(key, value) {\n            if (typeof key === 'undefined') {\n                defaults = this.data()\n            } else {\n                defaults = Object.assign(\n                    {},\n                    cloneDeep(defaults),\n                    value ? ({ [key]: value }) : key,\n                )\n            }\n\n            return this\n        },\n\n        setError(key, value) {\n            Object.assign(this.errors, (value ? { [key]: value } : key))\n\n            this.hasErrors = Object.keys(this.errors).length > 0\n\n            return this\n        },\n\n        reset(...fields) {\n            const clonedDefaults = cloneDeep(defaults)\n            if (fields.length === 0) {\n                Object.assign(this, clonedDefaults)\n            } else {\n                Object.assign(\n                    this,\n                    Object\n                        .keys(clonedDefaults)\n                        .filter(key => fields.includes(key))\n                        .reduce((carry, key) => {\n                            carry[key] = clonedDefaults[key]\n                            return carry\n                        }, {}),\n                )\n            }\n\n            return this\n        },\n        clearErrors(...fields) {\n            this.errors = Object\n                .keys(this.errors)\n                .reduce((carry, field) => ({\n                    ...carry,\n                    ...(fields.length > 0 && !fields.includes(field) ? { [field]: this.errors[field] } : {}),\n                }), {})\n\n            this.hasErrors = Object.keys(this.errors).length > 0\n\n            return this\n        },\n\n        submit(method, url, options = {}) {\n            this.processing = true\n            let data = transform(this.data())\n\n            if ((hasFiles(data)) && !(data instanceof FormData)) {\n                data = objectToFormData(data)\n            }\n\n            const _options = {\n                ...options,\n                onSuccess: async response => {\n                    this.processing = false\n                    const onSuccess = options.onSuccess ? await options.onSuccess(response) : null\n                    this.isDirty = false\n                    return onSuccess\n                },\n                onError: errors => {\n                    this.processing = false\n                    this.clearErrors().setError(errors)\n                    if (options.onError) {\n                        return options.onError(errors)\n                    }\n                },\n                onFinish: () => {\n                    this.processing = false\n                    if (options.onFinish) {\n                        return options.onFinish()\n                    }\n                },\n            }\n            if (method === \"delete\") {\n                Inertia.delete(url, { ..._options, data })\n            } else {\n                Http[method](url, data, _options)\n            }\n        },\n        get(url, options) {\n            this.submit(\"post\", url, options)\n        },\n\n        post(url, options) {\n            this.submit(\"post\", url, options)\n        },\n\n        put(url, options) {\n            this.submit(\"put\", url, options)\n        },\n\n        delete(url, options) {\n            this.submit(\"delete\", url, options)\n        },\n    })\n\n    watch(form, newValue => {\n        form.isDirty = !isEqual(form.data(), defaults)\n    }, {\n        immediate: true,\n        deep: true,\n    })\n\n    return form\n}\n"],"names":["Route","visit","href","params","options","method","data","onSuccess","onError","onFinish","url","URL","toString","window","location","hrefToUrl","axios","then","response","catch","error","errors","status","responseErrors","Object","keys","forEach","name","get","post","this","put","delete","hasFiles","File","Blob","FileList","length","FormData","Array","from","values","some","value","objectToFormData","source","form","parentKey","key","prototype","hasOwnProperty","call","append","composeKey","parent","isArray","index","Date","toISOString","Http","args","slice","arguments","defaults","cloneDeep","transform","reactive","isDirty","processing","callback","reduce","carry","assign","setError","hasErrors","reset","fields","clonedDefaults","filter","includes","clearErrors","field","submit","_options","_this","_temp","Inertia","watch","newValue","isEqual","immediate","deep"],"mappings":"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"}