{"version":3,"file":"index.modern.js","sources":["../src/route.js","../src/enum.js","../src/url.ts","../src/files.ts","../src/formData.ts","../src/useForm.js","../src/index.ts"],"sourcesContent":["import axios from \"axios\"\nimport { METHOD } from \"./enum\"\nimport { hrefToUrl } from \"./url\"\n\nexport class Route {\n    visit(href, params) {\n        const options = {\n            method: METHOD.GET,\n            data: {},\n            onSuccess: () => {},\n            onError: () => {},\n            onFinish: () => {},\n            ...params,\n        }\n\n        let url = typeof href === \"string\" ? hrefToUrl(href) : href\n\n        const {\n            onSuccess,\n            onError,\n            onFinish,\n        } = options\n\n        axios({\n            method: options.method,\n            url: url.href,\n            data: options.data,\n        }).then(response => {\n            return onSuccess(response)\n        }).catch(error => {\n            const errors = {}\n            if (error.response?.status === 422) {\n                const responseErrors = error.response.data.errors\n                Object.keys(responseErrors).forEach((name) => {\n                    errors[name] = responseErrors[name][0]\n                })\n            }\n            return onError(errors)\n        }).then(() => {\n            return onFinish()\n        })\n    }\n\n    get(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.GET,\n            data,\n        })\n    }\n\n    post(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.POST,\n            data,\n        })\n    }\n\n    put(url, data = {}, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.PUT,\n            data,\n        })\n    }\n\n    delete(url, options = {}) {\n        return this.visit(url, {\n            ...options,\n            method: METHOD.DELETE,\n        })\n    }\n}\n","export const METHOD = {\n    GET: \"get\",\n    POST: \"post\",\n    PUT: \"put\",\n    PATCH: \"patch\",\n    DELETE: \"delete\",\n}\n","export function hrefToUrl(href: string | URL): URL {\n    return new URL(href.toString(), window.location.toString())\n}\n","import { FormDataConvertible, RequestPayload } from './types'\n\nexport function hasFiles(data: RequestPayload | FormDataConvertible): boolean {\n    return (\n        data instanceof File ||\n        data instanceof Blob ||\n        (data instanceof FileList && data.length > 0) ||\n        (data instanceof FormData && Array.from(data.values()).some((value) => hasFiles(value))) ||\n        (typeof data === 'object' && data !== null && Object.values(data).some((value) => hasFiles(value)))\n    )\n}\n","import { FormDataConvertible } from \"./types\"\n\nexport function objectToFormData(\n    source: Record<string, FormDataConvertible>,\n    form: FormData = new FormData(),\n    parentKey: string | null = null,\n): FormData {\n    source = source || {}\n\n    for (const key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n            append(form, composeKey(parentKey, key), source[key])\n        }\n    }\n\n    return form\n}\n\nfunction composeKey(parent: string | null, key: string): string {\n    return parent ? parent + \"[\" + key + \"]\" : key\n}\n\nfunction append(form: FormData, key: string, value: FormDataConvertible): void {\n    if (Array.isArray(value)) {\n        return Array.from(value.keys()).forEach((index) => append(form, composeKey(key, index.toString()), value[index]))\n    } else if (value instanceof Date) {\n        return form.append(key, value.toISOString())\n    } else if (value instanceof File) {\n        return form.append(key, value, value.name)\n    } else if (value instanceof Blob) {\n        return form.append(key, value)\n    } else if (typeof value === \"boolean\") {\n        return form.append(key, value ? \"1\" : \"0\")\n    } else if (typeof value === \"string\") {\n        return form.append(key, value)\n    } else if (typeof value === \"number\") {\n        return form.append(key, `${value}`)\n    } else if (value === null || value === undefined) {\n        return form.append(key, \"\")\n    }\n\n    objectToFormData(value, form, key)\n}\n","import cloneDeep from \"lodash.clonedeep\"\nimport isEqual from \"lodash.isequal\"\nimport { reactive, watch } from \"vue\"\nimport { Route } from \"./route\"\nimport { hasFiles } from './files'\nimport { objectToFormData } from './formData'\n\nexport default function useForm(...args) {\n    const data = (typeof args[0] === \"string\" ? args[1] : args[0]) || {}\n    let defaults = cloneDeep(data)\n    let transform = data => data\n    const Http = new Route()\n\n    const form = reactive({\n        ...data,\n        errors: {},\n        isDirty: false,\n        processing: false,\n\n        transform(callback) {\n            transform = callback\n\n            return this\n        },\n\n        data() {\n            return Object\n                .keys(data)\n                .reduce((carry, key) => {\n                    carry[key] = this[key]\n                    return carry\n                }, {})\n        },\n\n        defaults(key, value) {\n            if (typeof key === 'undefined') {\n                defaults = this.data()\n            } else {\n                defaults = Object.assign(\n                    {},\n                    cloneDeep(defaults),\n                    value ? ({ [key]: value }) : key,\n                )\n            }\n\n            return this\n        },\n\n        setError(key, value) {\n            Object.assign(this.errors, (value ? { [key]: value } : key))\n\n            this.hasErrors = Object.keys(this.errors).length > 0\n\n            return this\n        },\n\n        reset(...fields) {\n            const clonedDefaults = cloneDeep(defaults)\n            if (fields.length === 0) {\n                Object.assign(this, clonedDefaults)\n            } else {\n                Object.assign(\n                    this,\n                    Object\n                        .keys(clonedDefaults)\n                        .filter(key => fields.includes(key))\n                        .reduce((carry, key) => {\n                            carry[key] = clonedDefaults[key]\n                            return carry\n                        }, {}),\n                )\n            }\n\n            return this\n        },\n        clearErrors(...fields) {\n            this.errors = Object\n                .keys(this.errors)\n                .reduce((carry, field) => ({\n                    ...carry,\n                    ...(fields.length > 0 && !fields.includes(field) ? { [field]: this.errors[field] } : {}),\n                }), {})\n\n            this.hasErrors = Object.keys(this.errors).length > 0\n\n            return this\n        },\n\n        submit(method, url, options = {}) {\n            this.processing = true\n            let data = transform(this.data())\n\n            if ((hasFiles(data)) && !(data instanceof FormData)) {\n                data = objectToFormData(data)\n            }\n\n            const _options = {\n                ...options,\n                onSuccess: async response => {\n                    this.processing = false\n                    const onSuccess = options.onSuccess ? await options.onSuccess(response) : null\n                    this.isDirty = false\n                    return onSuccess\n                },\n                onError: errors => {\n                    this.processing = false\n                    this.clearErrors().setError(errors)\n                    if (options.onError) {\n                        return options.onError(errors)\n                    }\n                },\n                onFinish: () => {\n                    this.processing = false\n                    if (options.onFinish) {\n                        return options.onFinish()\n                    }\n                },\n            }\n            if (method === \"delete\") {\n                Inertia.delete(url, { ..._options, data })\n            } else {\n                Http[method](url, data, _options)\n            }\n        },\n        get(url, options) {\n            this.submit(\"post\", url, options)\n        },\n\n        post(url, options) {\n            this.submit(\"post\", url, options)\n        },\n\n        put(url, options) {\n            this.submit(\"put\", url, options)\n        },\n\n        delete(url, options) {\n            this.submit(\"delete\", url, options)\n        },\n    })\n\n    watch(form, newValue => {\n        form.isDirty = !isEqual(form.data(), defaults)\n    }, {\n        immediate: true,\n        deep: true,\n    })\n\n    return form\n}\n","import { Route } from \"./route\"\nexport { default as useForm } from \"./useForm\"\nexport const Http = new Route()\n"],"names":["Route","visit","href","params","options","method","data","onSuccess","onError","onFinish","url","URL","toString","window","location","hrefToUrl","axios","then","response","catch","error","_error$response","errors","status","responseErrors","Object","keys","forEach","name","get","_extends","post","put","delete","this","hasFiles","File","Blob","FileList","length","FormData","Array","from","values","some","value","objectToFormData","source","form","parentKey","key","prototype","hasOwnProperty","call","append","composeKey","parent","isArray","index","Date","toISOString","useForm","args","defaults","cloneDeep","transform","Http","reactive","isDirty","processing","callback","reduce","carry","assign","setError","hasErrors","reset","fields","clonedDefaults","filter","includes","clearErrors","field","submit","_options","async","Inertia","watch","newValue","isEqual","immediate","deep"],"mappings":"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"}